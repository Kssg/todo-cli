# 開發心得：Todo CLI 小工具

## 開發動機

為了熟悉 C 語言實作、練習檔案處理與字串解析技巧，並同時製作一個可以放進履歷作品集的 CLI 工具，我設計並實作了一個命令列代辦清單工具 `todo`。

這個工具支援：
- 新增代辦事項
- 完成事項標記
- 刪除代辦項目
- 清單列出（包含完成狀態）

---

## 技術細節

### 使用語言與工具

- C (標準 C11)
- `fopen` / `fgets` / `strtok` 等標準 C 檔案與字串處理
- 自訂結構 `TodoItem` 來包裝每筆代辦
- Makefile 自動編譯（簡化版）

### 資料格式設計

每一行代辦事項以 `id|title|done` 儲存在文字檔 `todo.txt` 中，例如：

    1|買牛奶|0
    2|完成 side project|1

透過 `strtok()` 做欄位解析，再結構化處理。

### 程式設計風格

- 使用模組化架構（`todo.c`, `todo.h`）將邏輯與主程式分離
- 抽出通用小函式：如 `read_all_lines()`、`parse_line()`、`write_all_items()` 提高重用性
- 每個 CLI 指令（如 `add_todo()`、`delete_todo()`）為獨立函式，主程式只做指令解析與呼叫

---

## 開發過程重點

- 初期先寫出最小可執行版本（MVP），快速驗證流程
- 之後開始重構重複邏輯，逐步拆解小函式
- 為了避免出現「魔法數字」，使用 `MAX_ITEMS`、`MAX_TITLE_LEN` 等常數統一管理
- 使用 `strncpy()`、長度檢查、特殊字元過濾，確保檔案資料格式安全性
- 嘗試使用 Makefile 的萬用字元與路徑轉換，但為了先成功執行，改為簡化版 Makefile

---

## 錯誤處理策略

為了讓 `todo.txt` 檔案損壞時能友善顯示錯誤、不中斷 CLI 工具，
我將 `parse_line()` 中的 `atoi()` 改成 `safe_atoi()`，並加入欄位級別的錯誤訊息。

`strtol()` 無法處理換行符號 `\r` 因此在輸入之前先使用 `strip_newline()` 清除尾部換行符號。

這樣一來即使格式異常（如：欄位缺失、非整數字串），也能清楚知道是哪一欄出錯。

---

## 學到的事

- 熟悉 C 語言中檔案處理、字串切割、錯誤處理邏輯
- 學會怎麼拆出有重複性的函式、避免邏輯散落在多個地方
- Makefile 編寫技巧（簡單與進階的路徑處理）
- 如何從最簡的程式逐步整理成乾淨、模組化、可維護的架構

---

## 未來可改進

- 支援代辦事項的截止日期與分類
- 將檔案格式改為 JSON 或 SQLite 儲存
- 加上測試腳本（如 shell 自動測試）
- 改為跨平台 GUI 工具（以 Python / Electron 為主）

---

## 檔案結構簡介
```
.
├── Makefile
├── todo.txt # 資料儲存檔案
├── src/
│ ├── main.c # 主程式：處理 CLI 指令
│ ├── todo.c # 邏輯實作（add, delete, done, list）
│ └── todo.h # 函式宣告與結構定義
└── docs/
└── dev-notes.md # 開發紀錄與心得（此檔案）
```

---

## 使用說明

```bash
make
./todo add "買牛奶"
./todo done 1
./todo delete 2
./todo list
```

---

## 更新紀錄

### 2025/07/29
- 加入 getopt() 處理參數，支援 -a、-d、-m、-l，可與原本的 add、delete 等子命令並行使用
- 增加 print_usage() 提示錯誤參數輸入(使用 -h)
- 程式會在啟動時自動建立 todo.txt（若不存在）
